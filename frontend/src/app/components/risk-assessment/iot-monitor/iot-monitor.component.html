<div class="iot-monitor">
  <header class="monitor-header">
    <div class="header-content">
      <h1>üîå IoT Real-time Monitoring</h1>
      <p class="subtitle">OBD-II Device Tracking - Real-time Vehicle Telemetry</p>
    </div>
    <div class="header-actions">
      <button 
        *ngIf="!isMonitoring" 
        (click)="startMonitoring()" 
        class="btn-start">
        Start Monitoring
      </button>
      <button 
        *ngIf="isMonitoring" 
        (click)="stopMonitoring()" 
        class="btn-stop">
        Stop Monitoring
      </button>
      <button 
        (click)="resetTrip()" 
        class="btn-reset">
        Reset Trip
      </button>
    </div>
  </header>

  <div class="monitor-grid">
    <!-- Primary Metrics -->
    <section class="card metrics-primary">
      <div class="metric-card" [style.border-left-color]="getSpeedColor()">
        <div class="metric-icon">üöó</div>
        <div class="metric-content">
          <span class="metric-label">Speed</span>
          <span class="metric-value">{{ currentMetrics?.speed || 0 }}</span>
          <span class="metric-unit">km/h</span>
        </div>
      </div>

      <div class="metric-card" [style.border-left-color]="getRpmColor()">
        <div class="metric-icon">‚öôÔ∏è</div>
        <div class="metric-content">
          <span class="metric-label">Engine RPM</span>
          <span class="metric-value">{{ currentMetrics?.rpm || 0 }}</span>
          <span class="metric-unit">rpm</span>
        </div>
      </div>

      <div class="metric-card" [style.border-left-color]="getEngineColor()">
        <div class="metric-icon">üå°Ô∏è</div>
        <div class="metric-content">
          <span class="metric-label">Engine Temperature</span>
          <span class="metric-value">{{ currentMetrics?.engineTemp || 0 }}</span>
          <span class="metric-unit">¬∞C</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">‚õΩ</div>
        <div class="metric-content">
          <span class="metric-label">Fuel Level</span>
          <span class="metric-value">{{ currentMetrics?.fuel || 0 }}</span>
          <span class="metric-unit">%</span>
        </div>
      </div>
    </section>

    <!-- Safety Score -->
    <section class="card safety-card">
      <h2>Safe Driving Score</h2>
      <div class="safety-score-display">
        <div class="score-ring" [style.border-color]="getSafetyColor()">
          <span class="score">{{ safetyScore }}</span>
          <span class="score-label">pts</span>
        </div>
        <div class="score-details">
          <div class="score-item">
            <span class="label">Hard Braking:</span>
            <span class="value">{{ currentMetrics?.harshBraking || 0 }} times</span>
          </div>
          <div class="score-item">
            <span class="label">Rapid Acceleration:</span>
            <span class="value">{{ currentMetrics?.harshAcceleration || 0 }} times</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Trip Stats -->
    <section class="card trip-stats">
      <h2>Trip Statistics</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-icon">üìç</div>
          <div class="stat-content">
            <span class="stat-label">Distance Traveled</span>
            <span class="stat-value">{{ tripDistance.toFixed(2) }} km</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">‚è±Ô∏è</div>
          <div class="stat-content">
            <span class="stat-label">Driving Time</span>
            <span class="stat-value">{{ formatDuration(tripDuration) }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Alerts -->
    <section class="card alerts-panel">
      <h2>Alert History</h2>
      <div class="alerts-list" *ngIf="alerts.length > 0">
        <div 
          *ngFor="let alert of alerts" 
          class="alert-item"
          [class.alert-danger]="alert.type === 'danger'"
          [class.alert-warning]="alert.type === 'warning'">
          <span class="alert-icon">{{ getAlertIcon(alert.type) }}</span>
          <div class="alert-content">
            <span class="alert-message">{{ alert.message }}</span>
            <span class="alert-time">{{ alert.timestamp | date:'HH:mm:ss' }}</span>
          </div>
        </div>
      </div>
      <div class="no-alerts" *ngIf="alerts.length === 0">
        <p>‚úÖ No alerts</p>
      </div>
    </section>

    <!-- Location Map -->
    <section class="card location-map">
      <h2>Current Location</h2>
      <div class="map-placeholder">
        <div class="map-icon">üó∫Ô∏è</div>
          <p class="coordinates" *ngIf="currentMetrics?.location">
            Latitude: {{ (currentMetrics?.location?.lat ?? 0).toFixed(4) }}<br>
            Longitude: {{ (currentMetrics?.location?.lng ?? 0).toFixed(4) }}
          </p>
        <p class="map-note">Map integration available with Google Maps API</p>
      </div>
    </section>

    <!-- Device Status -->
    <section class="card device-status">
      <h2>Device Status</h2>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Device ID:</span>
          <span class="status-value">{{ deviceId }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Connection Status:</span>
          <span class="status-value" [class.status-active]="isMonitoring">
            {{ isMonitoring ? 'Connected' : 'Standby' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">Data Points:</span>
          <span class="status-value">{{ metricsHistory.length }}/20</span>
        </div>
      </div>
    </section>