<div class="iot-monitor">
  <header class="monitor-header">
    <div class="header-content">
      <h1>ğŸ”Œ IoTãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</h1>
      <p class="subtitle">OBD-II Device Tracking - Real-time Vehicle Telemetry</p>
    </div>
    <div class="header-actions">
      <button 
        *ngIf="!isMonitoring" 
        (click)="startMonitoring()" 
        class="btn-start">
        ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é–‹å§‹
      </button>
      <button 
        *ngIf="isMonitoring" 
        (click)="stopMonitoring()" 
        class="btn-stop">
        ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°åœæ­¢
      </button>
      <button 
        (click)="resetTrip()" 
        class="btn-reset">
        ãƒˆãƒªãƒƒãƒ—ãƒªã‚»ãƒƒãƒˆ
      </button>
    </div>
  </header>

  <div class="monitor-grid">
    <!-- Primary Metrics -->
    <section class="card metrics-primary">
      <div class="metric-card" [style.border-left-color]="getSpeedColor()">
        <div class="metric-icon">ğŸš—</div>
        <div class="metric-content">
          <span class="metric-label">é€Ÿåº¦</span>
          <span class="metric-value">{{ currentMetrics?.speed || 0 }}</span>
          <span class="metric-unit">km/h</span>
        </div>
      </div>

      <div class="metric-card" [style.border-left-color]="getRpmColor()">
        <div class="metric-icon">âš™ï¸</div>
        <div class="metric-content">
          <span class="metric-label">ã‚¨ãƒ³ã‚¸ãƒ³å›è»¢æ•°</span>
          <span class="metric-value">{{ currentMetrics?.rpm || 0 }}</span>
          <span class="metric-unit">rpm</span>
        </div>
      </div>

      <div class="metric-card" [style.border-left-color]="getEngineColor()">
        <div class="metric-icon">ğŸŒ¡ï¸</div>
        <div class="metric-content">
          <span class="metric-label">ã‚¨ãƒ³ã‚¸ãƒ³æ¸©åº¦</span>
          <span class="metric-value">{{ currentMetrics?.engineTemp || 0 }}</span>
          <span class="metric-unit">Â°C</span>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">â›½</div>
        <div class="metric-content">
          <span class="metric-label">ç‡ƒæ–™æ®‹é‡</span>
          <span class="metric-value">{{ currentMetrics?.fuel || 0 }}</span>
          <span class="metric-unit">%</span>
        </div>
      </div>
    </section>

    <!-- Safety Score -->
    <section class="card safety-card">
      <h2>å®‰å…¨é‹è»¢ã‚¹ã‚³ã‚¢</h2>
      <div class="safety-score-display">
        <div class="score-ring" [style.border-color]="getSafetyColor()">
          <span class="score">{{ safetyScore }}</span>
          <span class="score-label">ç‚¹</span>
        </div>
        <div class="score-details">
          <div class="score-item">
            <span class="label">æ€¥ãƒ–ãƒ¬ãƒ¼ã‚­:</span>
            <span class="value">{{ currentMetrics?.harshBraking || 0 }}å›</span>
          </div>
          <div class="score-item">
            <span class="label">æ€¥åŠ é€Ÿ:</span>
            <span class="value">{{ currentMetrics?.harshAcceleration || 0 }}å›</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Trip Stats -->
    <section class="card trip-stats">
      <h2>ãƒˆãƒªãƒƒãƒ—çµ±è¨ˆ</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-icon">ğŸ“</div>
          <div class="stat-content">
            <span class="stat-label">èµ°è¡Œè·é›¢</span>
            <span class="stat-value">{{ tripDistance.toFixed(2) }} km</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-content">
            <span class="stat-label">èµ°è¡Œæ™‚é–“</span>
            <span class="stat-value">{{ formatDuration(tripDuration) }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Alerts -->
    <section class="card alerts-panel">
      <h2>ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</h2>
      <div class="alerts-list" *ngIf="alerts.length > 0">
        <div 
          *ngFor="let alert of alerts" 
          class="alert-item"
          [class.alert-danger]="alert.type === 'danger'"
          [class.alert-warning]="alert.type === 'warning'">
          <span class="alert-icon">{{ getAlertIcon(alert.type) }}</span>
          <div class="alert-content">
            <span class="alert-message">{{ alert.message }}</span>
            <span class="alert-time">{{ alert.timestamp | date:'HH:mm:ss' }}</span>
          </div>
        </div>
      </div>
      <div class="no-alerts" *ngIf="alerts.length === 0">
        <p>âœ… ã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
      </div>
    </section>

    <!-- Location Map -->
    <section class="card location-map">
      <h2>ç¾åœ¨ä½ç½®</h2>
      <div class="map-placeholder">
        <div class="map-icon">ğŸ—ºï¸</div>
          <p class="coordinates" *ngIf="currentMetrics?.location">
            ç·¯åº¦: {{ currentMetrics.location.lat.toFixed(4) }}<br>
            çµŒåº¦: {{ currentMetrics.location.lng.toFixed(4) }}
          </p>
        <p class="map-note">åœ°å›³çµ±åˆã¯ Google Maps API ã§å®Ÿè£…å¯èƒ½</p>
      </div>
    </section>

    <!-- Device Status -->
    <section class="card device-status">
      <h2>ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹</h2>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">ãƒ‡ãƒã‚¤ã‚¹ID:</span>
          <span class="status-value">{{ deviceId }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">æ¥ç¶šçŠ¶æ…‹:</span>
          <span class="status-value" [class.status-active]="isMonitoring">
            {{ isMonitoring ? 'æ¥ç¶šä¸­' : 'å¾…æ©Ÿä¸­' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ:</span>
          <span class="status-value">{{ metricsHistory.length }}/20</span>
        </div>
      </div>
    </section>