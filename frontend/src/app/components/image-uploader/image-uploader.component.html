<div class="image-uploader">
  <header class="header">
    <form class="insurance-form mb-3" autocomplete="off">
      <!-- Row 1: Policy Number (left) | Address (right) -->
      <div class="two-cols">
        <div class="form-row form-row--compact">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- document SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 2v6h6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Policy Number:</label>
          <input type="text" [(ngModel)]="fields.policy_number" name="policy_number" [readonly]="true" placeholder="Policy Number" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- address SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 11l9-7 9 7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5 11v8a1 1 0 0 0 1 1h3v-6h6v6h3a1 1 0 0 0 1-1v-8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Address:</label>
          <input type="text" [(ngModel)]="fields.address" name="address" [readonly]="true" placeholder="Address" />
        </div>
      </div>

      <!-- Row 2: Full Name | City/State/Zip -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- user SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Full Name:</label>
          <input type="text" [(ngModel)]="fields.full_name" name="full_name" [readonly]="true" placeholder="Full Name" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- location SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="10" r="2" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>City/State/Zip:</label>
          <input type="text" [(ngModel)]="fields.city_state_zip" name="city_state_zip" [readonly]="true" placeholder="City, State, Zip" />
        </div>
      </div>

      <!-- Row 3: Email | Phone -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- mail SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 8l9 6 9-6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Email:</label>
          <input type="text" [(ngModel)]="fields.email" name="email" [readonly]="true" placeholder="Email" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- phone SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.12.94.4 1.85.82 2.69a2 2 0 0 1-.45 2.11L10.6 9.4a16 16 0 0 0 6 6l1.88-1.88a2 2 0 0 1 2.11-.45c.84.4 1.75.7 2.69.82A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Phone:</label>
          <input type="text" [(ngModel)]="fields.phone" name="phone" [readonly]="true" placeholder="Phone" />
        </div>
      </div>

      <!-- Row 4: DOB | Gender -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- calendar SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </span>DOB:</label>
          <input type="text" [(ngModel)]="fields.dob" name="dob" [readonly]="true" placeholder="Date of Birth" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- user SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Gender:</label>
          <input type="text" [(ngModel)]="fields.gender" name="gender" [readonly]="true" placeholder="Gender" />
        </div>
      </div>

      <!-- Row 5: Policy Type | Issue Date -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- file SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Policy Type:</label>
          <input type="text" [(ngModel)]="fields.policy_type" name="policy_type" [readonly]="true" placeholder="Policy Type" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- calendar SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </span>Issue Date:</label>
          <input type="text" [(ngModel)]="fields.issue_date" name="issue_date" [readonly]="true" placeholder="Issue Date" />
        </div>
      </div>

      <!-- Row 6: Term Length | Renewal Date -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- clock SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.2"/>
                <path d="M12 7v6l4 2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Term Length:</label>
          <input type="text" [(ngModel)]="fields.term_length" name="term_length" [readonly]="true" placeholder="Term Length" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- calendar SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </span>Renewal Date:</label>
          <input type="text" [(ngModel)]="fields.renewal_date" name="renewal_date" [readonly]="true" placeholder="Renewal Date" />
        </div>
      </div>

      <!-- Row 7: Agent | Agent ID -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- agent SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12l-2-3 2-3 2 3-2 3z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 20v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Agent:</label>
          <input type="text" [(ngModel)]="fields.agent" name="agent" [readonly]="true" placeholder="Agent" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- id card SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="1.2"/>
                <circle cx="9" cy="10" r="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M15 8h4M15 12h4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </span>Agent ID:</label>
          <input type="text" [(ngModel)]="fields.agent_id" name="agent_id" [readonly]="true" placeholder="Agent ID" />
        </div>
      </div>

      <!-- Row 8: Vehicle | VIN -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- car SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 13l1-4h16l1 4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM19 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Vehicle (Year/Make/Model):</label>
          <input type="text" [(ngModel)]="fields.vehicle" name="vehicle" [readonly]="true" placeholder="Year/Make/Model" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- vin SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M7 8h10" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </span>VIN:</label>
          <input type="text" [(ngModel)]="fields.vin" name="vin" [readonly]="true" placeholder="VIN" />
        </div>
      </div>

      <!-- Row 9: Office Phone | License Plate -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- phone SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.08 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.12.94.4 1.85.82 2.69a2 2 0 0 1-.45 2.11L10.6 9.4a16 16 0 0 0 6 6l1.88-1.88a2 2 0 0 1 2.11-.45c.84.4 1.75.7 2.69.82A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>Office Phone:</label>
          <input type="text" [(ngModel)]="fields.office_phone" name="office_phone" [readonly]="true" placeholder="Office Phone" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- license plate SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="7" width="20" height="10" rx="2" stroke="currentColor" stroke-width="1.5"/>
                <path d="M7 12h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </span>License Plate:</label>
          <input type="text" [(ngModel)]="fields.license_plate" name="license_plate" [readonly]="true" placeholder="License Plate" />
        </div>
      </div>

      <!-- Row 10: Body Type | Garaging Zip -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- body type SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 13l1-4h16l1 4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM19 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Body Type:</label>
          <input type="text" [(ngModel)]="fields.body_type" name="body_type" [readonly]="true" placeholder="Body Type" />
        </div>
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- zip SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="10" r="2" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Garaging Zip:</label>
          <input type="text" [(ngModel)]="fields.garaging_zip" name="garaging_zip" [readonly]="true" placeholder="Garaging Zip" />
        </div>
      </div>

      <!-- Row 11: Usage Class (left) with empty right column to preserve spacing -->
      <div class="two-cols">
        <div class="form-row">
          <label class="label-with-icon"><span class="icon" aria-hidden="true">
              <!-- usage SVG -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.59 13.41L11 3 3 11l8.59 8.59a2 2 0 0 0 2.82 0L20.59 16.2a2 2 0 0 0 0-2.82z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="1.2"/>
              </svg>
            </span>Usage Class:</label>
          <input type="text" [(ngModel)]="fields.usage_class" name="usage_class" [readonly]="true" placeholder="Usage Class" />
        </div>
        <div class="form-row"><!-- intentionally blank --></div>
      </div>

      <!-- Final single row: Annual Mileage alone on the left -->
      <div class="form-row">
        <label class="label-with-icon"><span class="icon" aria-hidden="true">
            <!-- mileage SVG -->
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 12h3l3-7 4 14 3-6h4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>Annual Mileage:</label>
        <input type="text" [(ngModel)]="fields.annual_mileage" name="annual_mileage" [readonly]="true" placeholder="Annual Mileage" />
      </div>
    </form>

    <div class="upload-section">
      <div class="action-row">
        <div class="file-input-wrapper">
          <label class="file-label action-btn" for="fileInput">Choose File</label>
          <input id="fileInput" type="file" accept="image/*,.pdf" (change)="onFileSelected($event)" style="display:none" />
        </div>

        <button class="action-btn" (click)="onUpload()" [disabled]="!selectedFile">
          Upload & Extract
        </button>

        <button class="action-btn secondary" (click)="clearForm()">
          Clear
        </button>

        <button class="action-btn return-home" (click)="returnHome()">
          Return Home
        </button>
      </div>
    </div>

    <div *ngIf="isProcessing" class="loading-overlay">
      <div class="spinner"></div>
      <p>{{ statusMessage }}</p>
    </div>

    <div *ngIf="error" class="error-message">
      <span class="error-icon">!</span>
      <span>{{ error }}</span>
    </div>

    <div *ngIf="ocrResult" class="result-section">
      <div class="result-black-bg">
        <h2>Extracted Text Blocks</h2>
        <div class="confidence-bar-wrapper">
          <div class="confidence-bar" [style.width]="getConfidenceScore() + '%'">
            Confidence: {{ getConfidenceScore() }}%
          </div>
          <div class="completeness-bar" [style.width]="getExtractionCompleteness() + '%'">
            Extraction: {{ getExtractionCompleteness() }}%
          </div>
        </div>
        <div *ngIf="ocrResult.text_blocks && ocrResult.text_blocks.length > 0; else noBlocks">
          <table class="ocr-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Text</th>
                <th>Confidence</th>
                <th>Bounding Box</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let block of ocrResult.text_blocks; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ block.text }}</td>
                <td>{{ (block.confidence * 100) | number: '1.0-2' }}%</td>
                <td>{{ block.bbox }}</td>
              </tr>
            </tbody>
          </table>
          <p class="summary">Average Confidence: {{ getConfidenceScore() }}%</p>
          <p class="summary">Extraction Completeness: {{ getExtractionCompleteness() }}%</p>
          <p class="summary">Full Text: <span class="full-text">{{ ocrResult.full_text }}</span></p>
        </div>
        <ng-template #noBlocks>
          <p>No text blocks detected.</p>
        </ng-template>
      </div>
    </div>
  </header>
</div>